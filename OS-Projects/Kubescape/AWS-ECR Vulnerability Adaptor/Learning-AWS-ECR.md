# Learning about AWS ECR

---

- Important Links
    - Docs - [https://docs.aws.amazon.com/AmazonECR/latest/userguide/what-is-ecr.html](https://docs.aws.amazon.com/AmazonECR/latest/userguide/what-is-ecr.html)
    - Image Scanning - [https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning.html](https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning.html)
- What is Amazon ECR?
    - `ECR` stands for Elastic Container Registry
    - Its an AWS managed container image registry service
        - **Registry** → A platform to store & access public and private container images 
        (can be called as a GitHub for Container Images)
    - Some other examples of public container image registeries are DockerHub, GCR (Google Container Registry), Harbor etc.
    - We can use any preferred CLI to `push`, `pull` and `manage` :
        - Docker images
        - Open Container Initiative (OCI) images
        - OCI compatible artifacts
- Components of Amazon ECR
    1. **Registry**
        - A private registry is provided to each AWS account
        - You can create one or more repositories in your registry and store images in them.
    2. **Authorization Token**
        - User needs to authenticate to Amazon ECR registries as an AWS user, to be able to access it & push or pull images.
    3. **Repository**
        - An ECR repo contains your Docker images, Open Container Initiative (OCI) images, and OCI compatible artifacts
    4. **Repository Policy**
        - Access to your repositories and the images within them can be controlled with the repository policies
    5. **Image**
        - Different container images that can be stored:
            - Docker Images
            - Open Container Initiative (OCI) images
            - OCI compatible artifacts
        - We can push or pull the images to our repositories
        - Ways in which we can use these images:
            - Locally on Dev System
            - Amazon ECS (Elastic Container Service) task definitions
            - Amazon EKS (Elastic Kubernetes Service) pod specifications
- Features Of ECR
    - **Lifecycle policies**
        - help in managing the lifecycle of images in the repositories
        - We can define rules such as - cleaning up unused images etc.
    - **Image Scanning**
        - helps in identifying software vulnerabilities in the container images
        - Each repository can be configured to `“scan on push”`
        - Image scan results can be easily retrieved
    - **Cross-Region & Account**
        - Images are accessible whenever you need them
    - **Pull through Cache rule**
        - provide a way to cache repositories in remote public registries in your private ECR registry
            - Repository Cache → replica of the Git data which is constantly updated by a background process/job
        - Using this, Amazon ECR will periodically reach out to the remote registry to ensure that the cached image in your private ECR registry is up to date
- Setting up Amazon ECR
    - Pre-requisites
        - AWS account
        - AWS CLI installed
        - Docker
    - Setting up IAM user
        - The very 1st step is to create an [IAM user](https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html) & give admin permissions to it
            - Its always recommended to work with an IAM user on AWS rather than directly on the root account
        - Login as an IAM user to the AWS console!
            - IAM user - `kunalverma-aws`
            
            ![](https://i.imgur.com/3sQ61gi.png)
            
    - Using ECR with AWS Console
        - Visit the [main page](https://www.notion.so/Learning-about-AWS-ECR-c535048c339544c2b183e048bc14c0ba) of ECR
        - Following the steps mentioned [here](https://docs.aws.amazon.com/AmazonECR/latest/userguide/getting-started-console.html)
        - You have created a private repo
            
            ![](https://i.imgur.com/xG6CRLb.png)
            
    - Using ECR with AWS CLI
        - Following the guide [here](https://docs.aws.amazon.com/AmazonECR/latest/userguide/getting-started-cli.html)
        - The `get-login-password`is the preferred method for authenticating to an Amazon ECR private registry when using the AWS CLI
            - to view the get-login-password for AWS CLI
                
                ```bash
                aws ecr get-login-password
                ```
                
        - To use with the Docker CLI, pipe the output of the `get-login-password`command to the `docker login`command
            
            ```bash
            aws ecr get-login-password --region <region> | docker login --username AWS --password-stdin <aws_account_id>.dkr.ecr.<region>.amazonaws.com
            
            # Output:
            
            Login Succeeded
            ```
            
        - Creating a new repository on ECR:
            
            ```bash
            aws ecr create-repository \
            > --repository-name hello-world \
            > --image-scanning-configuration scanOnPush=true \
            > --region ap-south-1
            ```
            